<form
  [formGroup]="dynamicForm"
  (ngSubmit)="submitEvent.emit(true)"
  class="p-3 flex flex-col"
>
  <ng-container
    *ngTemplateOutlet="
      renderControlRecursive;
      context: {
        control: dynamicForm,
        controlKey: null
      }
    "
  ></ng-container>

  <ngx-button-component
    [disable]="dynamicForm.pristine || dynamicForm.invalid"
    roundedFull="rounded-md"
    >Submit
  </ngx-button-component>
</form>

<ng-template
  #renderControlRecursive
  let-control="control"
  let-controlKey="controlKey"
>
  <ng-container [ngSwitch]="control.constructor.name">
    <!-- Render FormArray -->
    <ng-container *ngSwitchCase="'FormArray'" data-test="ftx-form-array">
      <div class="flex flex-wrap">
        <ng-container
          *ngFor="
            let arrayControl of control.controls;
            trackBy: generateFormBuilderService.trackBy
          "
          data-test="indexArray"
        >
          {{ ivan(arrayControl) }}
          <ng-container
            *ngTemplateOutlet="
              renderControlRecursive;
              context: { control: arrayControl, controlKey: controlKey }
            "
          >
          </ng-container>
        </ng-container>
      </div>
    </ng-container>
    <!-- Render FormGroup -->
    <ng-container *ngSwitchCase="'FormGroup'" data-test="ftx-form-group">
      <ng-container
        *ngFor="
          let groupControl of control.controls | keyvalue;
          trackBy: generateFormBuilderService.trackBy
        "
      >
        {{ ivan(groupControl) }}

        <ng-container
          *ngTemplateOutlet="
            renderControlRecursive;
            context: {
              control: groupControl.value,
              controlKey: groupControl.key
            }
          "
        ></ng-container>
      </ng-container>
    </ng-container>
    <!-- Render FormControl -->
    <ng-container *ngSwitchDefault>
      {{ ivan({ control, name:control.constructor.name, controlKey }) }}

      <ngx-form-control-label
        data-test="controlKey"
        [formControl]="control"
        [labelInput]="controlMapping[controlKey]?.labelHint"
        [label]="controlKey"
        [placeholderInput]="controlMapping[controlKey]?.placeholder"
        [toggleData]="controlMapping[controlKey]?.valueToggleShow"
        [typeInput]="controlMapping[controlKey]?.typeInput"
      ></ngx-form-control-label>
    </ng-container>
  </ng-container>
</ng-template>
