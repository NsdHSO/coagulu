<form
  [formGroup]="dynamicForm"
  (ngSubmit)="submitEvent.emit(true)"
  class="p-3 flex flex-col"
>
  <ng-container
    *ngTemplateOutlet="
      renderControlRecursive;
      context: {
        control: dynamicForm,
        controlKey: null
      }
    "
  ></ng-container>

  <ngx-button-component
    [disable]="dynamicForm.pristine || dynamicForm.invalid"
    roundedFull="rounded-md"
    >Submit
  </ngx-button-component>
</form>

<ng-template
  #renderControlRecursive
  let-control="control"
  let-controlKey="controlKey"
>
  <ng-container
    [ngSwitch]="generateFormBuilderService.getCustomFromControlType(control)"
  >
    <!-- Render FormArray -->
    <ng-container *ngSwitchCase="'FormArray'">
      <div class="flex flex-wrap">
        <ng-container
          *ngFor="
            let arrayControl of control.controls;
            trackBy: generativeService.trackBy
          "
        >
          <ng-container
            *ngTemplateOutlet="
              renderControlRecursive;
              context: { control: arrayControl, controlKey: controlKey }
            "
          >
          </ng-container>
        </ng-container>
      </div>
    </ng-container>
    <!-- Render FormGroup -->
    <ng-container *ngSwitchCase="'FormGroup'">
      <ng-container
        *ngFor="
          let groupControl of control.controls | keyvalue;
          trackBy: generativeService.trackBy
        "
      >
        <ng-container
          *ngTemplateOutlet="
            renderControlRecursive;
            context: {
              control: groupControl.value,
              controlKey: groupControl.key
            }
          "
        ></ng-container>
      </ng-container>
    </ng-container>
    <!-- Render FormControl -->
    <ng-container *ngSwitchDefault>
      <div class="w-full border-t border-b border-slate-200/60 border-solid">
        <ngx-form-control-label
          data-test="controlKey"
          [formControl]="control"
          [labelInput]="controlMapping[controlKey]?.labelHint"
          [label]="controlKey"
          [placeholderInput]="controlMapping[controlKey]?.placeholder"
          [toggleData]="controlMapping[controlKey]?.valueToggleShow"
          [typeInput]="controlMapping[controlKey]?.typeInput"
        />
      </div>
    </ng-container>
  </ng-container>
</ng-template>
